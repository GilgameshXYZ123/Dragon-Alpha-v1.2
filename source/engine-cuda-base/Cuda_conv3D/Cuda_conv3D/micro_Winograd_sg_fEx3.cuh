#pragma once

#ifndef MICRO_WINOGRAD_F14X3_H
#define MICRO_WINOGRAD_F14X3_H

//======{ Filtrer-Transform: W(3) -> G(16) }==========
//with less multiplication(42 -> 21)
#define winograd_f14x3_G(g, w) {\
	float t1, t2;\
	g[0] = w[0];\
	t1 = -2.222222e-03f*w[0] - 2.222222e-03f*w[2];\
	t2 = -2.222222e-03f*w[1];\
	g[1] = t1 + t2; g[2] = t1 - t2;\
	t1 = 1.2093727E-5f*w[0] + 4.8374906E-5f*w[2];\
	t2 = 2.4187453E-5f*w[1];\
	g[3] = t1 + t2; g[4] = t1 - t2;\
	t1 = 0.19814362f*w[0] + 0.049535904f*w[2];\
	t2 = 0.09907181f*w[1];\
	g[5] = t1 + t2; g[6] = t1 - t2;\
	t1 = -2.854289E-7f*w[0] - 2.5688596E-6f*w[2];\
	t2 = -8.562866E-7f*w[1];\
	g[7] = t1 + t2; g[8] = t1 - t2;\
	t1 = -1.3651974f*w[0] - 0.15168859f*w[2];\
	t2 = -0.4550658f*w[1];\
	g[9] = t1 + t2; g[10] = t1 - t2;\
	t1 = 6.2184937E-9f*w[0] + 9.94959E-8f*w[2];\
	t2 = 2.4873975E-8f*w[1];\
	g[11] = t1 + t2; g[12] = t1 - t2;\
	t1 = 1.6692642f *w[0] + 0.10432901f*w[2];\
	t2 = 0.41731605f*w[1];\
	g[13] = t1 + t2; g[14] = t1 - t2;\
	g[15] = w[2];}



//======{ Input-Transform: X[16] -> D[16] }==========
//with less multiplication(420 -> 210)
#define winograd_f14x3_D(d, x) {\
	float t1, t2;\
	d[0] = x[0] - 30.42361f*x[2] + 285.7587f*x[4] - 937.158f*x[6] + 937.158f*x[8] - 285.7587f*x[10] + 30.42361f*x[12] - x[14];\
	t1 = x[1] - 29.42361f*x[3] + 256.3351f*x[5] - 680.8229f*x[7] + 256.3351f*x[ 9] - 29.42361f*x[11] + x[13];\
	t2 = x[2] - 29.42361f*x[4] + 256.3351f*x[6] - 680.8229f*x[8] + 256.3351f*x[10] - 29.42361f*x[12] + x[14];\
	d[1] = t2 + t1; d[2] = t2 - t1;\
	t1 =  0.5f*x[1] - 15.08681f*x[3] + 139.1076f*x[5] - 433.8021f*x[7] + 360.1285f*x[ 9] - 52.84722f*x[11] + 2.0f*x[13];\
	t2 = 0.25f*x[2] - 7.543403f*x[4] + 69.55382f*x[6] - 216.9010f*x[8] + 180.0642f*x[10] - 26.42361f*x[12] +      x[14];\
	d[3] = t2 + t1; d[4] = t2 - t1;\
	t1 = 2.0f*x[1] - 52.84722f*x[3] + 360.1285f*x[5] - 433.8021f*x[7] + 139.1076f*x[ 9] - 15.08681f*x[11] + 0.5f*x[13];\
	t2 = 4.0f*x[2] - 105.6944f*x[4] + 720.2569f*x[6] - 867.6042f*x[8] + 278.2153f*x[10] - 30.17361f*x[12] +      x[14];\
	d[5] = t2 + t1; d[6] = t2 - t1;\
	t1 = 0.3333333f*x[1] - 10.10417f*x[3] + 94.13021f*x[5] - 301.9271f*x[7] + 278.8385f*x[ 9] - 64.27083f*x[11] + 3.0f*x[13];\
	t2 = 0.1111111f*x[2] - 3.368056f*x[4] + 31.37674f*x[6] - 100.6424f*x[8] + 92.94618f*x[10] - 21.42361f*x[12] +      x[14];\
	d[7] = t2 + t1; d[8] = t2 - t1;\
	t1 = 3.0f*x[1] - 64.27083f*x[3] + 278.8385f*x[5] - 301.9271f*x[7] + 94.13021f*x[ 9] - 10.10417f*x[11] + 0.3333333f*x[13];\
	t2 = 9.0f*x[2] - 192.8125f*x[4] + 836.5156f*x[6] - 905.7812f*x[8] + 282.3906f*x[10] - 30.31250f*x[12] +            x[14];\
	d[9] = t2 + t1; d[10] = t2 - t1;\
	t1 = 0.25f  *x[1] - 7.590278f*x[3] + 70.96528f*x[5] - 229.8542f*x[7] + 219.9236f*x[ 9] - 57.69444f*x[11] + 4.0f*x[13];\
	t2 = 0.0625f*x[2] - 1.897569f*x[4] + 17.74132f*x[6] - 57.46354f*x[8] + 54.98090f*x[10] - 14.42361f*x[12] +      x[14];\
	d[11] = t2 + t1; d[12] = t2 - t1;\
	t1 =  4.0f*x[1] - 57.69444f*x[3] + 219.9236f*x[5] - 229.8542f*x[7] + 70.96528f*x[ 9] - 7.590278E+00f*x[11] + 0.25f*x[13];\
	t2 = 16.0f*x[2] - 230.7778f*x[4] + 879.6944f*x[6] - 919.4167f*x[8] + 283.8611f*x[10] - 3.036111E+01f*x[12] +       x[14];\
	d[13] = t2 + t1; d[14] = t2 - t1;\
	d[15] = -x[1] + 30.42361f*x[3] - 285.7587f*x[5] + 937.158f*x[7] - 937.158f*x[9] + 285.7587f*x[11] - 30.42361f*x[13] + x[15];}


//======{ Ouput-Transform: A[16] -> Y[14] }==========
//with less multiplication(420 -> 210)
#define winograd_f14x3_Y(y, a) {\
	float  t1 = a[ 1] + a[ 2],  t2 = a[ 1] - a[ 2];\
	float  t3 = a[ 3] + a[ 4],  t4 = a[ 3] - a[ 4];\
	float  t5 = a[ 5] + a[ 6],  t6 = a[ 5] - a[ 6];\
	float  t7 = a[ 7] + a[ 8],  t8 = a[ 7] - a[ 8];\
	float  t9 = a[ 9] + a[10], t10 = a[ 9] - a[10];\
	float t11 = a[11] + a[12], t12 = a[11] - a[12];\
	float t13 = a[13] + a[14], t14 = a[13] - a[14];\
    y[ 0] = a[0] + t1 + t3 + t5 + t7 + t9 + t11 + t13;\
	y[ 1] = t2 +    2.0f*t4 + 0.5f        *t6 +       3.0f*t8 + 0.3333333f  *t10 +        4.0f*t12 + 0.25f       *t14;\
	y[ 2] = t1 +    4.0f*t3 + 0.25f       *t5 +       9.0f*t7 + 0.1111111f   *t9 +       16.0f*t11 + 0.0625f     *t13;\
	y[ 3] = t2 +    8.0f*t4 + 0.125f      *t6 +      27.0f*t8 + 0.03703704f *t10 +       64.0f*t12 + 0.015625f   *t14;\
	y[ 4] = t1 +   16.0f*t3 + 0.0625f     *t5 +      81.0f*t7 + 0.01234568f  *t9 +      256.0f*t11 + 0.00390625f *t13;\
	y[ 5] = t2 +   32.0f*t4 + 0.03125f    *t6 +     243.0f*t8 + 0.004115226f*t10 +     1024.0f*t12 + 9.765625E-4f*t14;\
	y[ 6] = t1 +   64.0f*t3 + 0.015625f   *t5 +     729.0f*t7 + 0.001371742f* t9 +     4096.0f*t11 + 2.441406E-4f*t13;\
	y[ 7] = t2 +  128.0f*t4 + 0.0078125f  *t6 +    2187.0f*t8 + 4.572474E-4f*t10 +    16384.0f*t12 + 6.103516E-5f*t14;\
	y[ 8] = t1 +  256.0f*t3 + 0.00390625f *t5 +    6561.0f*t7 + 1.524158E-4f* t9 +    65536.0f*t11 + 1.525879E-5f*t13;\
	y[ 9] = t2 +  512.0f*t4 + 0.001953125f*t6 +   19683.0f*t8 + 5.080526E-5f*t10 +   262144.0f*t12 + 3.814697E-6f*t14;\
	y[10] = t1 + 1024.0f*t3 + 9.765625E-4f*t5 +   59049.0f*t7 + 1.693509E-5f* t9 +  1048576.0f*t11 + 9.536743E-7f*t13;\
	y[11] = t2 + 2048.0f*t4 + 4.882812E-4f*t6 +  177147.0f*t8 + 5.645029E-6f*t10 +  4194304.0f*t12 + 2.384186E-7f*t14;\
	y[12] = t1 + 4096.0f*t3 + 2.441406E-4f*t5 +  531441.0f*t7 + 1.881676E-6f* t9 + 1.677722E7f*t11 + 5.960464E-8f*t13;\
	y[13] = t2 + 8192.0f*t4 + 1.220703E-4f*t6 + 1594323.0f*t8 + 6.272255E-7f*t10 + 6.710886E7f*t12 + 1.490116E-8f*t14 + a[15]; }


#endif