#pragma once

#ifndef MICRO_WINOGRAD_F8X9_H
#define MICRO_WINOGRAD_F8X9_H

const bool enable_Winograd_F8X9 = true;

//======{ Filtrer-Transform: W(9) -> G(16) }==========
//with less multiplication
#define winograd_f8x9_G(g, w) {\
	float t1, t2;\
	g[0] = w[0];\
	t1 = -2.222222E-03f * (w[0] + w[2] + w[4] + w[6] + w[8]);\
	t2 = -2.222222E-03f * (w[1] + w[3] + w[5] + w[7]);\
	g[1] = t1 + t2; g[2] = t1 - t2;\
	t1 =  1.209373E-05f * w[0] + 4.837491E-05f * w[2] + 1.934996E-04f * w[4] + 7.739985E-04f * w[6] + 3.095994E-03f * w[8];\
	t2 =  2.418745E-05f * w[1] + 9.674981E-05f * w[3] + 3.869993E-04f * w[5] + 1.547997E-03f * w[7];\
	g[3] = t1 + t2; g[4] = t1 - t2;\
	t1 =  1.981436E-01f * w[0] + 4.953590E-02f * w[2] + 1.238398E-02f * w[4] + 3.095994E-03f * w[6] + 7.739985E-04f * w[8];\
	t2 =  9.907181E-02f * w[1] + 2.476795E-02f * w[3] + 6.191988E-03f * w[5] + 1.547997E-03f * w[7];\
	g[5] = t1 + t2; g[6] = t1 - t2;\
	t1 = -2.854289E-07f * w[0] - 2.568860E-06f * w[2] - 2.311974E-05f * w[4] - 2.080776E-04f * w[6] - 1.872699E-03f * w[8];\
	t2 = -8.562866E-07f * w[1] - 7.706579E-06f * w[3] - 6.935922E-05f * w[5] - 6.242329E-04f * w[7];\
	g[7] = t1 + t2; g[8] = t1 - t2;\
	t1 = -1.365197E+00f * w[0] - 1.516886E-01f * w[2] - 1.685429E-02f * w[4] - 1.872699E-03f * w[6] - 2.080776E-04f * w[8];\
	t2 = -4.550658E-01f * w[1] - 5.056287E-02f * w[3] - 5.618096E-03f * w[5] - 6.242329E-04f * w[7];\
	g[9] = t1 + t2; g[10] = t1 - t2;\
	t1 =  6.218494E-09f * w[0] + 9.949590E-08f * w[2] + 1.591934E-06f * w[4] + 2.547095E-05f * w[6] + 4.075352E-04f * w[8];\
	t2 =  2.487397E-08f * w[1] + 3.979836E-07f * w[3] + 6.367738E-06f * w[5] + 1.018838E-04f * w[7];\
	g[11] = t1 + t2; g[12] = t1 - t2;\
	t1 =  1.669264E+00f * w[0] + 1.043290E-01f * w[2] + 6.520563E-03f * w[4] + 4.075352E-04f * w[6] + 2.547095E-05f * w[8];\
	t2 =  4.173160E-01f * w[1] + 2.608225E-02f * w[3] + 1.630141E-03f * w[5] + 1.018838E-04f * w[7];\
	g[13] = t1 + t2; g[14] = t1 - t2;\
	g[15] = w[8];}


//======{ Input-Transform: X[16] -> D[16] }==========
//with less multiplication(420 -> 210)
#define winograd_f8x9_D(d, x) {\
	float t1, t2;\
	d[0] = x[0] - 3.042361E+01f*x[2] + 2.857587E+02f*x[4] - 9.371580E+02f*x[6] + 9.371580E+02f*x[8] - 2.857587E+02f*x[10] + 3.042361E+01f*x[12] - x[14];\
	t1 = x[1] - 2.942361E+01f*x[3] + 2.563351E+02f*x[5] - 6.808229E+02f*x[7] + 2.563351E+02f*x[ 9] - 2.942361E+01f*x[11] + x[13];\
	t2 = x[2] - 2.942361E+01f*x[4] + 2.563351E+02f*x[6] - 6.808229E+02f*x[8] + 2.563351E+02f*x[10] - 2.942361E+01f*x[12] + x[14];\
	d[1] = t2 + t1; d[2] = t2 - t1;\
	t1 = 0.50f*x[1] - 1.508681E+01f*x[3] + 1.391076E+02f*x[5] - 4.338021E+02f*x[7] + 3.601285E+02f*x[ 9] - 5.284722E+01f*x[11] + 2.0f*x[13];\
	t2 = 0.25f*x[2] - 7.543403E+00f*x[4] + 6.955382E+01f*x[6] - 2.169010E+02f*x[8] + 1.800642E+02f*x[10] - 2.642361E+01f*x[12] +      x[14];\
	d[3] = t2 + t1; d[4] = t2 - t1;\
	t1 = 2.0f*x[1] - 5.284722E+01f*x[3] + 3.601285E+02f*x[5] - 4.338021E+02f*x[7] + 1.391076E+02f*x[ 9] - 1.508681E+01f*x[11] + 0.5f*x[13];\
	t2 = 4.0f*x[2] - 1.056944E+02f*x[4] + 7.202569E+02f*x[6] - 8.676042E+02f*x[8] + 2.782153E+02f*x[10] - 3.017361E+01f*x[12] +      x[14];\
	d[5] = t2 + t1; d[6] = t2 - t1;\
	t1 = 0.3333333f*x[1] - 1.010417E+01f*x[3] + 9.413021E+01f*x[5] - 3.019271E+02f*x[7] + 2.788385E+02f*x[ 9] - 6.427083E+01f*x[11] + 3.0f*x[13];\
	t2 = 0.1111111f*x[2] - 3.368056E+00f*x[4] + 3.137674E+01f*x[6] - 1.006424E+02f*x[8] + 9.294618E+01f*x[10] - 2.142361E+01f*x[12] +      x[14];\
	d[7] = t2 + t1; d[8] = t2 - t1;\
	t1 = 3.0f*x[1] - 6.427083E+01f*x[3] + 2.788385E+02f*x[5] - 301.9271f*x[7] + 9.413021E+01f*x[ 9] - 1.010417E+01f*x[11] + 0.3333333f*x[13];\
	t2 = 9.0f*x[2] - 1.928125E+02f*x[4] + 8.365156E+02f*x[6] - 905.7812f*x[8] + 2.823906E+02f*x[10] - 3.031250E+01f*x[12] +            x[14];\
	d[9] = t2 + t1; d[10] = t2 - t1;\
	t1 = 0.25f  *x[1] - 7.590278E+00f*x[3] + 7.096528E+01f*x[5] - 2.298542E+02f*x[7] + 2.199236E+02f*x[ 9] - 5.769444E+01f*x[11] + 4.0f*x[13];\
	t2 = 0.0625f*x[2] - 1.897569E+00f*x[4] + 1.774132E+01f*x[6] - 5.746354E+01f*x[8] + 5.498090E+01f*x[10] - 1.442361E+01f*x[12] +      x[14];\
	d[11] = t2 + t1; d[12] = t2 - t1;\
	t1 =  4.0f*x[1] - 5.769444E+01f*x[3] + 2.199236E+02f*x[5] - 2.298542E+02f*x[7] + 7.096528E+01f*x[ 9] - 7.590278E+00f*x[11] + 0.25f*x[13];\
	t2 = 16.0f*x[2] - 2.307778E+02f*x[4] + 8.796944E+02f*x[6] - 9.194167E+02f*x[8] + 2.838611E+02f*x[10] - 3.036111E+01f*x[12] +       x[14];\
	d[13] = t2 + t1; d[14] = t2 - t1;\
	d[15] = -x[1] + 3.042361E+01f*x[3] - 2.857587E+02f*x[5] + 9.371580E+02f*x[7] -9.371580E+02f*x[9] + 2.857587E+02f*x[11] - 3.042361E+01f*x[13] + x[15];}

#define winograd_f8x9_D_oft(d, x, oft) {\
	float t1, t2;\
	d[0] = x[0 + oft] - 3.042361E+01f*x[2 + oft] + 2.857587E+02f*x[4 + oft] - 9.371580E+02f*x[6 + oft] + 9.371580E+02f*x[8 + oft] - 2.857587E+02f*x[10 + oft] + 3.042361E+01f*x[12 + oft] - x[14 + oft];\
	t1 = x[1 + oft] - 2.942361E+01f*x[3 + oft] + 2.563351E+02f*x[5 + oft] - 6.808229E+02f*x[7 + oft] + 2.563351E+02f*x[ 9 + oft] - 2.942361E+01f*x[11 + oft] + x[13 + oft];\
	t2 = x[2 + oft] - 2.942361E+01f*x[4 + oft] + 2.563351E+02f*x[6 + oft] - 6.808229E+02f*x[8 + oft] + 2.563351E+02f*x[10 + oft] - 2.942361E+01f*x[12 + oft] + x[14 + oft];\
	d[1] = t2 + t1; d[2] = t2 - t1;\
	t1 = 0.50f*x[1 + oft] - 1.508681E+01f*x[3 + oft] + 1.391076E+02f*x[5 + oft] - 4.338021E+02f*x[7 + oft] + 3.601285E+02f*x[ 9 + oft] - 5.284722E+01f*x[11 + oft] + 2.0f*x[13 + oft];\
	t2 = 0.25f*x[2 + oft] - 7.543403E+00f*x[4 + oft] + 6.955382E+01f*x[6 + oft] - 2.169010E+02f*x[8 + oft] + 1.800642E+02f*x[10 + oft] - 2.642361E+01f*x[12 + oft] +      x[14 + oft];\
	d[3] = t2 + t1; d[4] = t2 - t1;\
	t1 = 2.0f*x[1 + oft] - 5.284722E+01f*x[3 + oft] + 3.601285E+02f*x[5 + oft] - 4.338021E+02f*x[7 + oft] + 1.391076E+02f*x[ 9 + oft] - 1.508681E+01f*x[11 + oft] + 0.5f*x[13 + oft];\
	t2 = 4.0f*x[2 + oft] - 1.056944E+02f*x[4 + oft] + 7.202569E+02f*x[6 + oft] - 8.676042E+02f*x[8 + oft] + 2.782153E+02f*x[10 + oft] - 3.017361E+01f*x[12 + oft] +      x[14 + oft];\
	d[5] = t2 + t1; d[6] = t2 - t1;\
	t1 = 0.3333333f*x[1 + oft] - 1.010417E+01f*x[3 + oft] + 9.413021E+01f*x[5 + oft] - 3.019271E+02f*x[7 + oft] + 2.788385E+02f*x[ 9 + oft] - 6.427083E+01f*x[11 + oft] + 3.0f*x[13 + oft];\
	t2 = 0.1111111f*x[2 + oft] - 3.368056E+00f*x[4 + oft] + 3.137674E+01f*x[6 + oft] - 1.006424E+02f*x[8 + oft] + 9.294618E+01f*x[10 + oft] - 2.142361E+01f*x[12 + oft] +      x[14 + oft];\
	d[7] = t2 + t1; d[8] = t2 - t1;\
	t1 = 3.0f*x[1 + oft] - 6.427083E+01f*x[3 + oft] + 2.788385E+02f*x[5 + oft] - 301.9271f*x[7 + oft] + 9.413021E+01f*x[ 9 + oft] - 1.010417E+01f*x[11 + oft] + 0.3333333f*x[13 + oft];\
	t2 = 9.0f*x[2 + oft] - 1.928125E+02f*x[4 + oft] + 8.365156E+02f*x[6 + oft] - 905.7812f*x[8 + oft] + 2.823906E+02f*x[10 + oft] - 3.031250E+01f*x[12 + oft] +            x[14 + oft];\
	d[9] = t2 + t1; d[10] = t2 - t1;\
	t1 = 0.25f  *x[1 + oft] - 7.590278E+00f*x[3 + oft] + 7.096528E+01f*x[5 + oft] - 2.298542E+02f*x[7 + oft] + 2.199236E+02f*x[ 9 + oft] - 5.769444E+01f*x[11 + oft] + 4.0f*x[13 + oft];\
	t2 = 0.0625f*x[2 + oft] - 1.897569E+00f*x[4 + oft] + 1.774132E+01f*x[6 + oft] - 5.746354E+01f*x[8 + oft] + 5.498090E+01f*x[10 + oft] - 1.442361E+01f*x[12 + oft] +      x[14 + oft];\
	d[11] = t2 + t1; d[12] = t2 - t1;\
	t1 =  4.0f*x[1 + oft] - 5.769444E+01f*x[3 + oft] + 2.199236E+02f*x[5 + oft] - 2.298542E+02f*x[7 + oft] + 7.096528E+01f*x[ 9 + oft] - 7.590278E+00f*x[11 + oft] + 0.25f*x[13 + oft];\
	t2 = 16.0f*x[2 + oft] - 2.307778E+02f*x[4 + oft] + 8.796944E+02f*x[6 + oft] - 9.194167E+02f*x[8 + oft] + 2.838611E+02f*x[10 + oft] - 3.036111E+01f*x[12 + oft] +       x[14 + oft];\
	d[13] = t2 + t1; d[14] = t2 - t1;\
	d[15] = -x[1 + oft] + 3.042361E+01f*x[3 + oft] - 2.857587E+02f*x[5 + oft] + 9.371580E+02f*x[7 + oft] -9.371580E+02f*x[9 + oft] + 2.857587E+02f*x[11 + oft] - 3.042361E+01f*x[13 + oft] + x[15 + oft];}


//======{ Ouput-Transform: A[16] -> Y[8] }==========
//with less multiplication(420 -> 210)
#define winograd_f8x9_Y(y, a) {\
	float  t1 = a[ 1] + a[ 2],  t2 = a[ 1] - a[ 2];\
	float  t3 = a[ 3] + a[ 4],  t4 = a[ 3] - a[ 4];\
	float  t5 = a[ 5] + a[ 6],  t6 = a[ 5] - a[ 6];\
	float  t7 = a[ 7] + a[ 8],  t8 = a[ 7] - a[ 8];\
	float  t9 = a[ 9] + a[10], t10 = a[ 9] - a[10];\
	float t11 = a[11] + a[12], t12 = a[11] - a[12];\
	float t13 = a[13] + a[14], t14 = a[13] - a[14];\
    y[ 0] = a[0] + t1 +        t3 +            t5 +         t7 +              t9  +          t11 +              t13;\
	y[ 1] =        t2 +   2.0f*t4 + 0.5f      *t6 +    3.0f*t8 + 0.3333333f  *t10 +     4.0f*t12 + 0.25f       *t14;\
	y[ 2] =        t1 +   4.0f*t3 + 0.25f     *t5 +    9.0f*t7 + 0.1111111f  *t9  +    16.0f*t11 + 0.0625f     *t13;\
	y[ 3] =        t2 +   8.0f*t4 + 0.125f    *t6 +   27.0f*t8 + 0.03703704f *t10 +    64.0f*t12 + 0.015625f   *t14;\
	y[ 4] =        t1 +  16.0f*t3 + 0.0625f   *t5 +   81.0f*t7 + 0.01234568f *t9  +   256.0f*t11 + 0.00390625f *t13;\
	y[ 5] =        t2 +  32.0f*t4 + 0.03125f  *t6 +  243.0f*t8 + 0.004115226f*t10 +  1024.0f*t12 + 9.765625E-4f*t14;\
	y[ 6] =        t1 +  64.0f*t3 + 0.015625f *t5 +  729.0f*t7 + 0.001371742f*t9  +  4096.0f*t11 + 2.441406E-4f*t13;\
	y[ 7] =        t2 + 128.0f*t4 + 0.0078125f*t6 + 2187.0f*t8 + 4.572474E-4f*t10 + 16384.0f*t12 + 6.103516E-5f*t14 + a[15]; }

#endif